<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="css/lp_new.css">
<script type="text/javascript" charset="utf8" src="http://code.jquery.com/jquery-1.12.4.min.js"></script>
<script type="text/javascript" charset="utf8" src="http://cdn.datatables.net/1.10.12/js/jquery.dataTables.js"></script>
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.columnFilter.js"></script>
</head>
<body class="w3-dark-grey w3-small">

<div id="navigation"></div>

<div id="sm_liiga" class="league">
	<ul class="w3-navbar w3-small w3-black w3-left-align">
		<li class="w3-hide-large w3-black w3-opennav w3-right">
			<a href="javascript:void(0);" onclick="openSmallNavi('liigaSmallNavi')"><i class="fa fa-bars"></i></a>
		</li>
		<li>
		<a onclick="leagueDropDown('liiga_drop')" href="#">Liiga <i class="fa fa-caret-down"></i></a>
		<div id="liiga_drop" class="w3-dropdown-content w3-blue-grey w3-card-4">
			<a class="w3-border-bottom" href="#" onclick="changeLeague('nhl')">NHL</a>
			<a href="#" onclick="changeLeague('valio')">Valioliiga</a>
		</div>
		</li>
		<li class="w3-hide-small tablink" onclick="openLink('Ottelulista', event);"><a href="#">Ottelulista</a></li>
		<li class="w3-hide-small tablink" onclick="openLink('Pelaajalista', event);"><a href="#">Pelaajalista</a></li>
		<li class="w3-hide-small tablink" onclick="openLink('Optimijoukkue', event);"><a href="#">Optimijoukkue</a></li>
		<li class="w3-hide-small tablink" onclick="openLink('Kokoonpanot', event);"><a href="#">Kokoonpanot</a></li>
		<li class="w3-hide-small w3-hide-medium w3-right"><a href="#">Email</a></li>
		<li class="w3-hide-small w3-hide-medium w3-right tablink" onclick="openLink('Status', event);"><a href="#">Status</a></li>
	</ul>

	<div id="liigaSmallNavi" class="w3-hide w3-hide-large">
		<ul class="w3-navbar w3-left-align w3-small w3-blue-grey">
		<li class="w3-hide-medium w3-border-bottom" onclick="$('div#sm_liiga').find('.tablink')[0].click();"><a href="#">Ottelulista</a></li>
		<li class="w3-hide-medium w3-border-bottom" onclick="$('div#sm_liiga').find('.tablink')[1].click();"><a href="#">Pelaajalista</a></li>
		<li class="w3-hide-medium w3-border-bottom" onclick="$('div#sm_liiga').find('.tablink')[2].click();"><a href="#">Optimijoukkue</a></li>
		<li class="w3-hide-medium w3-border-bottom" onclick="$('div#sm_liiga').find('.tablink')[3].click();"><a href="#">Kokoonpanot</a></li>
		<li class="w3-border-bottom" style="width:100%"><a style="width:100%" href="#">Email</a></li>
		<li style="width:100%" onclick="$('div#sm_liiga').find('.tablink')[4].click();"><a style="width:100%" href="#">Status</a></li>
		</ul>
	</div>
</div>

<div id="nhl" class="league">
	<ul class="w3-navbar w3-small w3-black w3-left-align">
		<li class="w3-hide-large w3-black w3-opennav w3-right">
			<a href="javascript:void(0);" onclick="openSmallNavi('nhlSmallNavi')"><i class="fa fa-bars"></i></a>
		</li>
		<li>
		<a onclick="leagueDropDown('nhl_drop')" href="#">NHL <i class="fa fa-caret-down"></i></a>
		<div id="nhl_drop" class="w3-dropdown-content w3-blue-grey w3-card-4">
			<a class="w3-border-bottom" href="#" onclick="changeLeague('sm_liiga')">Liiga</a>
			<a href="#" onclick="changeLeague('valio')">Valioliiga</a>
		</div>
		</li>
		<li class="w3-hide-small tablink" onclick="openLink('Ottelulista', event);"><a href="#">Ottelulista</a></li>
		<li class="w3-hide-small tablink" onclick="openLink('Pelaajalista', event);"><a href="#">Pelaajalista</a></li>
		<li class="w3-hide-small tablink" onclick="openLink('Optimijoukkue', event);"><a href="#">Optimijoukkue</a></li>
		<li class="w3-hide-small w3-hide-medium w3-right"><a href="#">Email</a></li>
		<li class="w3-hide-small w3-hide-medium w3-right tablink" onclick="openLink('Status', event);"><a href="#">Status</a></li>
	</ul>

	<div id="nhlSmallNavi" class="w3-hide w3-hide-large">
		<ul class="w3-navbar w3-left-align w3-small w3-blue-grey">
		<li class="w3-hide-medium w3-border-bottom" onclick="$('div#nhl').find('.tablink')[0].click();"><a href="#">Ottelulista</a></li>
		<li class="w3-hide-medium w3-border-bottom" onclick="$('div#nhl').find('.tablink')[1].click();"><a href="#">Pelaajalista</a></li>
		<li class="w3-hide-medium w3-border-bottom" onclick="$('div#nhl').find('.tablink')[2].click();"><a href="#">Optimijoukkue</a></li>
		<li class="w3-border-bottom" style="width:100%"><a style="width:100%" href="#">Email</a></li>
		<li style="width:100%" onclick="$('div#sm_liiga').find('.tablink')[3].click();"><a style="width:100%" href="#">Status</a></li>
		</ul>
	</div>
</div>

<div id="valio" class="league">
	<ul class="w3-navbar w3-small w3-black w3-left-align">
		<li class="w3-hide-large w3-black w3-opennav w3-right">
			<a href="javascript:void(0);" onclick="openSmallNavi('valioSmallNavi')"><i class="fa fa-bars"></i></a>
		</li>
		<li>
		<a onclick="leagueDropDown('valio_drop')" href="#">Valioliiga <i class="fa fa-caret-down"></i></a>
		<div id="valio_drop" class="w3-dropdown-content w3-blue-grey w3-card-4">
			<a class="w3-border-bottom" href="#" onclick="changeLeague('sm_liiga')">Liiga</a>
			<a href="#" onclick="changeLeague('nhl')">NHL</a>
		</div>
		</li>
		<li class="w3-hide-small tablink" onclick="openLink('Ottelulista', event);"><a href="#">Ottelulista</a></li>
		<li class="w3-hide-small w3-hide-medium w3-right"><a href="#">Email</a></li>
		<li class="w3-hide-small w3-hide-medium w3-right tablink" onclick="openLink('Status', event);"><a href="#">Status</a></li>
	</ul>

	<div id="valioSmallNavi" class="w3-hide w3-hide-large">
		<ul class="w3-navbar w3-left-align w3-small w3-blue-grey">
		<li class="w3-hide-medium w3-border-bottom" onclick="$('div#valio').find('.tablink')[0].click();"><a href="#">Ottelulista</a></li>
		<li class="w3-border-bottom" style="width:100%"><a style="width:100%" href="#">Email</a></li>
		<li style="width:100%" onclick="$('div#sm_liiga').find('.tablink')[1].click();"><a style="width:100%" href="#">Status</a></li>
		</ul>
	</div>
</div>

<script>
$(document).ready(function() {
	changeLeague("sm_liiga");
	initAnalytics();
});

function initPlayerListTable() {
	var t = $("#playertable").dataTable({
	"paging": false,
	<!-- Jarjestys aluksi -->
	"order": [[ 10, "desc" ]],
	<!-- Jarjestys klikatessa -->
	"aoColumns": [
		null,
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		{ "asSorting": [ "desc", "asc" ] },
		null
	],
	<!-- Secondary sorttaus -->
		columnDefs: [ {
			targets: [ 1 ],
			orderData: [ 1, 12 ]
		}, {
			targets: [ 2 ],
			orderData: [ 2, 12 ]
		}, {
			targets: [ 4 ],
			orderData: [ 4, 6, 12 ]
		}, {
			targets: [ 5 ],
			orderData: [ 5, 6, 12 ]
		}, {
			targets: [ 6 ],
			orderData: [ 6, 4, 12 ]
		}, {
			targets: [ 7 ],
			orderData: [ 7, 12 ]
		}, {
			targets: [ 8 ],
			orderData: [ 8, 12 ]
		}, {
			targets: [ 9 ],
			orderData: [ 9, 12 ]
		}, {
			targets: [ 10 ],
			orderData: [ 10, 12 ]
		}, {
			targets: [ 11 ],
			orderData: [ 11, 12 ]
		} ]
	})
	.columnFilter({aoColumns:[
		null,
		{ sSelector: "#pelipaikka", type:"select" },
		{ sSelector: "#joukkue", type:"select" },
		null, null, null, null, null, null, null, null, null, null, null
	]});
}

function initAnalytics() {
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-26708167-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
}

function leagueDropDown(id) {
    var x = document.getElementById(id);
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}

function closeAllLeagueDropDowns() {
	var dropDowns = $('div.w3-dropdown-content');
	jQuery.each(dropDowns, function(i, dropDown) {
		dropDown.className = dropDown.className.replace(" w3-show", "");
	});
}

function changeLeague(league) {
    var i;
    var x = document.getElementsByClassName("league");
    for (i = 0; i < x.length; i++) {
       x[i].style.display = "none";
    }
    document.getElementById(league).style.display = "block";
	init();
	selectDefaultTab(league);
	closeAllLeagueDropDowns();
}

function init() {
	$('#startDayOption').html('');
	$('#endDayOption').html('');
	showSlide(1);
}

function openSmallNavi(id) {
    var x = document.getElementById(id);
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}

function openLink(linkName, evt) {
	changeLinkDiv(linkName);
	callFunction(linkName);
	var i, x, tablinks;
	//Mark clicked element with red color
	x = document.getElementsByClassName('tablink');
	tablinks = document.getElementsByClassName('tablink');
	for (i = 0; i < x.length; i++) {
		tablinks[i].className = tablinks[i].className.replace(" w3-red", "");
	}
	if (typeof evt !== 'undefined') {
		evt.currentTarget.className += " w3-red";
	}
}

function changeLinkDiv(linkName) {
    var i;
    var x = document.getElementsByClassName("link");
    for (i = 0; i < x.length; i++) {
       x[i].style.display = "none";
    }
    document.getElementById(linkName).style.display = "block";
}

function callFunction (linkName) {
	//https://www.sitepoint.com/call-javascript-function-string-without-using-eval/
	// find object
	var fn = window[linkName];

	// is object a function?
	if (typeof fn === "function") fn();
}

function getSelectedLeague() {
	var league;
	var i;
	var x = document.getElementsByClassName("league");
    for (i = 0; i < x.length; i++) {
       if (x[i].style.display == "block") {
			league = $(x[i]).attr("id");
	   }
    }
	return league;
}

function selectDefaultTab(league) {
	var mybtn = $('div#' + league).find('.tablink')[0];
	mybtn.click();
}

function showSlide(n) {
	var i;
	var x = document.getElementsByClassName("slideDiv");
	var dots = document.getElementsByClassName("slideButton");
	for (i = 0; i < x.length; i++) {
		x[i].style.display = "none";
	}
	for (i = 0; i < dots.length; i++) {
		dots[i].className = dots[i].className.replace(" w3-red", "");
	}
	x[n-1].style.display = "block";
	dots[n-1].className += " w3-red";
}

function Ottelulista(subList) {
	if (subList === undefined) {
		subList = 'gameDays,teamCompareTable,optimalChangeDay,startDayOption,endDayOption';
	}
	var league = getSelectedLeague();
	var startDay = $('#Ottelulista').find('#startDayOption option:selected').html();
	var endDay = $('#Ottelulista').find('#endDayOption option:selected').html();
	var teamFrom = $('#teamFrom option:selected').html();
	$.ajax({
		type: 'POST',
		url: 'lp_new.pl',
		data: {'sub':subList,'liiga':league,'start_day':startDay,'end_day':endDay,'team_from':teamFrom},
		dataType: 'json',
		success: function(res) {
			$.each(res, function (name, value) {
				$('#Ottelulista').find('#' + name).html(value);
			});
		},
		error: function() {
			$('#gameDays').html("Some problem occurred trying to run Ottelulista");
			$('#teamCompareTable').html("Some problem occurred trying to run Ottelulista");
			$('#optimalChangeDay').html("Some problem occurred trying to run Ottelulista");
		}
	});
}

function Pelaajalista(subList) {
	if (subList === undefined) {
		subList = 'playerList,periodOptionMenu,yearOptionMenu';
	}
	var league = getSelectedLeague();
	var vuosi = $('#vuosi option:selected').html();
	var period = $('#periodOptionMenu option:selected').html();
	$.ajax({
		type: 'POST',
		url: 'lp_new.pl',
		data: {'sub':subList,'liiga':league,'vuosi':vuosi,'read_players_from':period},
		dataType: 'json',
		success: function(res) {
			$.each(res, function (name, value) {
				$('#Pelaajalista').find('#' + name).html(value);
			});
			initPlayerListTable();
		},
		error: function() {
			$('#playerList').html("Some problem occurred trying to run Pelaajalista");
		}
	});
}

function Optimijoukkue(subList) {
	if (subList === undefined) {
		subList = 'selectedTeams,optimiJoukkue,maxPelatutPelit,periodOptionMenu,startDayOption,endDayOption';
	}
	var league = getSelectedLeague();
	var period = $('#periodOptionMenu option:selected').html();
	var startDay = $('#Optimijoukkue').find('#startDayOption option:selected').html();
	var endDay = $('#Optimijoukkue').find('#endDayOption option:selected').html();
	$.ajax({
		type: 'POST',
		url: 'lp_new.pl',
		data: {'sub':subList,'liiga':league,'read_players_from':period,'start_day':startDay,'end_day':endDay},
		dataType: 'json',
		success: function(res) {
			$.each(res, function (name, value) {
				$('#Optimijoukkue').find('#' + name).html(value);
			});
		},
		error: function() {
			$('#playerList').html("Some problem occurred trying to run Pelaajalista");
		}
	});
}

function Status() {
	//$("#Status").load("status.htm");
	$("#Status").load("status.htm", function(responseTxt, statusTxt, xhr){
		if(statusTxt == "success")
			$("#Status").html(responseTxt);
		if(statusTxt == "error")
			$("#Status").html("Error: " + xhr.status + ": " + xhr.statusText);
	});
}
</script>

<div class="page w3-container w3-padding-top w3-padding-bottom">

<div id="Ottelulista" class="link">
	<div class="w3-center w3-responsive">
		<button class="w3-btn slideButton" onclick="showSlide(1)">Ottelulista</button>
		<button class="w3-btn slideButton" onclick="showSlide(2)">Vastustajat</button>
		<button class="w3-btn slideButton" onclick="showSlide(3)">Vaihdon ajoitus</button>
	</div>
	<center>
	Start: <select id='startDayOption' onchange='Ottelulista()'></select>
	End: <select id='endDayOption' onchange='Ottelulista()'></select>
	<div id="gameDays" class="slideDiv"></div>
	<div id="teamCompareTable" class="slideDiv"></div>
	<div id="optimalChangeDay" class="slideDiv"></div>
	</center>
</div>

<div id="Pelaajalista" class="link">
	<center>
	<select id='yearOptionMenu' onchange="Pelaajalista('playerList')"></select>
	<select id='periodOptionMenu' onchange="Pelaajalista('playerList')"></select>
	<p id="nimi" style="display:inline"></p>
	<p id="pelipaikka" style="display:inline"></p>
	<p id="joukkue" style="display:inline"></p>
	<p id="pelit" style="display:inline"></p>
	<p id="maalit" style="display:inline"></p>
	<p id="syotot" style="display:inline"></p>
	<p id="pisteet" style="display:inline"></p>
	<p id="laukaukset" style="display:inline"></p>
	<p id="arvo" style="display:inline"></p>
	<p id="lpp" style="display:inline"></p>
	<p id="lpp_per_peli" style="display:inline"></p>
	<p id="hinta_per_laatu" style="display:inline"></p>
	<p id="ennuste_graafi" style="display:inline"></p>

	<div id="playerList"></div>
	</center>
</div>

<div id="Optimijoukkue" class="link">
	<center>
	Täällä voit koota laskennallisia optimikokoonpanoja antamillasi ehdoilla.<br>
    Joukkueen arvo tE
    <input type='text' id='joukkueen_hinta' size='6' maxlength='6' value=2000>

	Pelatut pelit väh.: <select id="maxPelatutPelit" onchange="Optimijoukkue('optimiJoukkue')"></select>

    Pelaajan arvo alle:
    <select id="arvo" onchange="Optimijoukkue('optimiJoukkue')">
    <option>999</option>
    <option>500</option>
    <option>450</option>
    <option>400</option>
    <option>350</option>
    <option>300</option>
    <option>250</option>
    </select>

    <select id="periodOptionMenu" onchange="Optimijoukkue('maxPelatutPelit,optimiJoukkue')"></select><br>

    Valitse aikaväli, jolle haluat optimikokoonpanon laskettavan:

    Start: <select id='startDayOption' onchange="Optimijoukkue('endDayOption,optimiJoukkue')"></select>
	End: <select id='endDayOption' onchange="Optimijoukkue('startDayOption,optimiJoukkue')"></select>

    <br>Kopioi tähän pelaajien nimiä, jotka haluat skipata. Esim. loukkaantuneita pelaajia.<br>
    <TEXTAREA NAME='remove_players' id='remove_players' cols=40 rows=4>
    </TEXTAREA><br>
    <br>

    Pelaajat valitaan näistä joukkueista. Poista joukkueen nimi, josta et halua pelaajia.<br>
    <TEXTAREA id='selectedTeams' cols=40 rows=4>
    </TEXTAREA><br>
    <br>

	<div class="w3-responsive" id="optimiJoukkue"></div>
	</center>
</div>

<div id="Kokoonpanot" class="link">
</div>

<div id="Status" class="link">
</div>

</div>
</body>
</html>
